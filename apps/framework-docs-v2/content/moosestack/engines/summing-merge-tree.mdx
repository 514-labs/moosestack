---
title: SummingMergeTree
description: ClickHouse table engine that automatically sums numeric columns
order: 5
category: reference
---

import { LanguageTabs, LanguageTabContent, Callout } from "@/components/mdx";

# SummingMergeTree

`SummingMergeTree` automatically sums numeric columns when merging rows with the same ORDER BY key. It's a simpler alternative to `AggregatingMergeTree` when you only need sum aggregations.

## When to Use

- Simple counters and metrics (page views, clicks, totals)
- Incrementing values by key
- When you only need SUM operations (not MAX, MIN, etc.)

## Usage

<LanguageTabs>
  <LanguageTabContent value="typescript">
```typescript
import { OlapTable, ClickHouseEngines } from "@514labs/moose-lib";

interface DailyMetrics {
  date: Date;
  page: string;
  views: number;
  clicks: number;
  revenue: number;
}

const metrics = new OlapTable<DailyMetrics>("daily_metrics", {
  engine: ClickHouseEngines.SummingMergeTree,
  orderByFields: ["date", "page"]
});
```
  </LanguageTabContent>
  <LanguageTabContent value="python">
```python
from moose_lib import OlapTable, OlapConfig
from moose_lib.blocks import SummingMergeTreeEngine
from pydantic import BaseModel
from datetime import date

class DailyMetrics(BaseModel):
    date: date
    page: str
    views: int
    clicks: int
    revenue: float

metrics = OlapTable[DailyMetrics]("daily_metrics", OlapConfig(
    engine=SummingMergeTreeEngine(),
    order_by_fields=["date", "page"]
))
```
  </LanguageTabContent>
</LanguageTabs>

## How It Works

1. **Insert**: Rows are written with their numeric values
2. **Background Merge**: Rows with the same ORDER BY key are combined—numeric columns are summed, non-numeric columns take the first value
3. **Query**: Read summed results directly

```
// Two inserts with same (date, page):
{ date: "2025-01-01", page: "/home", views: 100, clicks: 5 }
{ date: "2025-01-01", page: "/home", views: 150, clicks: 8 }

// After merge:
{ date: "2025-01-01", page: "/home", views: 250, clicks: 13 }
```

## Specifying Columns to Sum

By default, all numeric columns are summed. You can specify which columns to sum:

<LanguageTabs>
  <LanguageTabContent value="typescript">
```typescript
const metrics = new OlapTable<DailyMetrics>("daily_metrics", {
  engine: ClickHouseEngines.SummingMergeTree,
  orderByFields: ["date", "page"],
  columns: ["views", "clicks"]  // Only sum these columns
});
```
  </LanguageTabContent>
  <LanguageTabContent value="python">
```python
metrics = OlapTable[DailyMetrics]("daily_metrics", OlapConfig(
    engine=SummingMergeTreeEngine(columns=["views", "clicks"]),
    order_by_fields=["date", "page"]
))
```
  </LanguageTabContent>
</LanguageTabs>

<Callout type="warning" title="Sum-only limitation">
SummingMergeTree only supports summation. For other aggregations (max, min, count distinct), use [AggregatingMergeTree](/moosestack/engines/aggregating-merge-tree) instead.
</Callout>

## SummingMergeTree vs AggregatingMergeTree

| Feature | SummingMergeTree | AggregatingMergeTree |
|---------|------------------|----------------------|
| Aggregations | SUM only | Any (sum, max, min, etc.) |
| Setup | Simpler—just use numeric columns | Requires `SimpleAggregateFunction` types |
| Use case | Simple counters | Complex rollups |

## See Also

- [AggregatingMergeTree](/moosestack/engines/aggregating-merge-tree) — For multiple aggregate functions
- [Replicated Engines](/moosestack/engines/replicated) — For high availability

