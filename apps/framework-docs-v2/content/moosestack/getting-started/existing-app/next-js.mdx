---
title: Add Moose to Next.js
description: Integrate MooseStack into an existing Next.js app with an engine-neutral contract
order: 8
category: getting-started
---

# Add Moose to Next.js

Use this guide to add MooseStack to an existing Next.js backend.

## 1. Create Moose workspace in your repo

```bash
moose init moose typescript --olap-engine clickhouse
pnpm install
```

## 2. Configure engine and profile

Add this to `moose/moose.config.toml`:

```toml
[olap]
engine = "clickhouse" # clickhouse | duckdb | snowflake
profile = "remote"
connection = "https://user:password@host:8443/db"

[dev_infra]
profile = "remote_hybrid" # local | remote_hybrid | remote_full
```

## 3. Set runtime env vars in Next.js

```bash title=".env.local"
MOOSE_CLIENT_ONLY=true
MOOSE_OLAP__ENGINE=clickhouse
MOOSE_OLAP__PROFILE=remote
MOOSE_OLAP__CONNECTION=https://user:password@host:8443/db
MOOSE_DEV_INFRA__PROFILE=remote_hybrid
```

## 4. Start development

```bash
pnpm -C moose moose dev --infra-profile remote_hybrid
pnpm dev
```

## 5. Plan and apply schema changes

```bash
pnpm -C moose moose generate migration \
  --olap-engine clickhouse \
  --olap-url "$MOOSE_OLAP__CONNECTION" \
  --save

pnpm -C moose moose migrate \
  --olap-engine clickhouse \
  --olap-url "$MOOSE_OLAP__CONNECTION"
```

## 6. Pull external tables when source schema changes

```bash
pnpm -C moose moose db pull \
  --olap-engine clickhouse \
  --olap-url "$MOOSE_OLAP__CONNECTION"
```

## Troubleshooting

- `connection_error`: validate `MOOSE_OLAP__CONNECTION` and credentials.
- `profile_misconfiguration`: make sure app profile and `moose dev` profile match.
- `capability_mismatch`: check [Engine Capability Matrix](/moosestack/reference/engine-capability-matrix).
