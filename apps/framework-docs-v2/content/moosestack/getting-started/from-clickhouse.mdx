---
title: Use with Existing ClickHouse
description: Use MooseStack with your existing ClickHouse database
order: 2
category: getting-started
---

import { Callout, ToggleBlock, ZoomImg, MuxVideo, BulletPointsCard, IconBadge, CTACards, CTACard, LanguageTabs, LanguageTabContent, FileTree, Tabs, TabsList, TabsTrigger, TabsContent } from "@/components/mdx";
import { PathConfig } from "@/lib/path-config";

# Use Moose with Your Existing ClickHouse

<div className="flex flex-wrap md:flex-nowrap gap-4 my-8">
<IconBadge Icon="Clock" label="5 min setup" variant="moose" />
<IconBadge Icon="Check" label="Zero disruption to prod" variant="moose" />
<IconBadge Icon="DeviceLaptop" label="Code-first, local dev" variant="moose" />
</div>

## What This Guide Does

This guide sets up a local ClickHouse development environment that mirrors your production database and enables code-first schema management:

1. **Introspect** your remote ClickHouse tables and generate TypeScript/Python data models
2. **Create** a local ClickHouse instance with your exact table schemas
3. **Seed** your local database with production data (optional)
4. **Build** APIs and pipelines on top of your ClickHouse data in code

## How It Works

**Local Development:**
- Your production ClickHouse remains untouched
- You get a local ClickHouse instance that copies your remote table schemas
- All development happens locally with hot-reload

**Production Deployment:**
- When you deploy your code, it connects to your remote ClickHouse
- Any new tables, materialized views, or schema changes you create in code are automatically migrated to your target database
- Your existing data and tables remain intact

<BulletPointsCard
  title="What You Get"
  bulletStyle="none"
  compact={true}
  bullets={[
    { title: "Schema management in code", description: "Define ClickHouse tables, materialized views, and schemas as TypeScript/Python code" },
    { title: "Auto-generated models", description: "TypeScript/Python classes generated from your existing ClickHouse tables" },
    { title: "Local development environment", description: "Local ClickHouse instance that mirrors your production schema" },
    { title: "Type-safe APIs", description: "Build REST APIs with full type safety and autocomplete" },
    { title: "Automatic migrations", description: "Schema changes are automatically applied to your target database on deployment" },
  ]}
/>

## Prerequisites

<LanguageTabs>
  <LanguageTabContent value="typescript">
<BulletPointsCard
  title="Before you start"
  bulletStyle="check"
  compact={true}
  divider={false}
  bullets={[
    { 
      title: "Existing ClickHouse Database", 
      description: "Any ClickHouse instance (Cloud, self-hosted, or playground)"
    },
    { 
      title: "Node.js 20+", 
      description: "Required for TypeScript development",
      link: { text: "Download ‚Üí", href: "https://nodejs.org/en/download", external: true }
    },
    { 
      title: "Docker Desktop", 
      description: "For local development environment",
      link: { text: "Download ‚Üí", href: "https://docs.docker.com/get-started/get-docker/", external: true }
    },
    {
      title: "macOS/Linux",
      description: "Windows works via WSL2"
    }
  ]}
/>
  </LanguageTabContent>
  <LanguageTabContent value="python">
<BulletPointsCard
  title="Before you start"
  bulletStyle="check"
  compact={true}
  divider={false}
  bullets={[
    { 
      title: "Existing ClickHouse Database", 
      description: "Any ClickHouse instance (Cloud, self-hosted, or playground)"
    },
    { 
      title: "Python 3.12+", 
      description: "Required for Python development",
      link: { text: "Download ‚Üí", href: "https://www.python.org/downloads/", external: true }
    },
    { 
      title: "Docker Desktop", 
      description: "For local development environment",
      link: { text: "Download ‚Üí", href: "https://docs.docker.com/get-started/get-docker/", external: true }
    },
    {
      title: "macOS/Linux",
      description: "Windows works via WSL2"
    }
  ]}
/>
  </LanguageTabContent>
</LanguageTabs>

<br />

## Step 1: Install Moose
Install the Moose CLI globally to your system:

```bash filename="Terminal" copy
bash -i <(curl -fsSL https://fiveonefour.com/install.sh) moose
```

<Callout type="info" title="What happens next">
After installation, you'll use `moose init` to create a new project that automatically connects to your ClickHouse and generates all the code you need.
</Callout>

## Step 2: Create Your Project

<Callout type="warning" title="Don't have ClickHouse?" icon="Database">
Use the ClickHouse Playground tab to try it out!
</Callout>

<Tabs defaultValue="own">
<TabsList>
<TabsTrigger value="own">Your own ClickHouse</TabsTrigger>
<TabsTrigger value="playground">ClickHouse Playground</TabsTrigger>
</TabsList>
<TabsContent value="own">

<LanguageTabs>
  <LanguageTabContent value="typescript">
```bash filename="Initialize new project" copy
# Option 1: Provide connection string directly
moose init my-project --from-remote <YOUR_CLICKHOUSE_CONNECTION_STRING> --language typescript

# Option 2: Run without connection string for interactive setup
moose init my-project --from-remote --language typescript
```
  </LanguageTabContent>
  <LanguageTabContent value="python">
```bash filename="Initialize new project" copy
# Option 1: Provide connection string directly
moose init my-project --from-remote <YOUR_CLICKHOUSE_CONNECTION_STRING> --language python

# Option 2: Run without connection string for interactive setup
moose init my-project --from-remote --language python
```
  </LanguageTabContent>
</LanguageTabs>

**Connection String Format:**
```
https://username:password@host:port/?database=database_name
```

<Callout type="info" title="Interactive Setup">
If you don't provide a connection string, Moose will guide you through an interactive setup process where you'll be prompted to enter:
- **Host and port** (e.g., `https://your-service-id.region.clickhouse.cloud:8443`)
- **Username** (usually `default`)
- **Password** (your ClickHouse password)
- **Database name** (optional, defaults to `default`)

This is perfect if you're not sure about your connection details or prefer a guided experience.
</Callout>

<Callout type="info" title="What gets generated" compact={true}>
Moose will create a complete project structure with:
- **Data models**: TypeScript/Python classes for every table in your ClickHouse
- **Type definitions**: Full type safety for all your data
- **Development environment**: Local ClickHouse instance that mirrors your production schema
- **Build tools**: Everything configured and ready to go
</Callout>
<ToggleBlock className="mb-4" openText="Troubleshooting" closeText="Hide troubleshooting">
- Make sure you are using the `HTTPS` connection string, not the `HTTP` connection string.
- Make sure the port is correct. For `HTTPS` the default is `8443`
- The default username is `default`
</ToggleBlock>


<ToggleBlock className="mb-4" openText="Need help finding your connection details?" closeText="Hide credential help">
See the section: <a href="#connect-to-your-remote-clickhouse" className="text-blue-500 hover:underline">Connect to your remote ClickHouse</a>.
</ToggleBlock>

</TabsContent>
<TabsContent value="playground">

<LanguageTabs>
  <LanguageTabContent value="typescript">
```bash filename="Try using the ClickHouse Playground!" copy
moose init my-project --from-remote https://explorer:@play.clickhouse.com:443/?database=default --language typescript
```
  </LanguageTabContent>
  <LanguageTabContent value="python">
```bash filename="Initialize new project" copy
# Generate code models from your existing ClickHouse tables
moose init my-project --from-remote https://explorer:@play.clickhouse.com:443/?database=default --language python
```
  </LanguageTabContent>
</LanguageTabs>

</TabsContent>
</Tabs>

<br />

<LanguageTabs>
  <LanguageTabContent value="typescript">
```bash filename="Install dependencies" copy
cd my-project
npm install
```
  </LanguageTabContent>
  <LanguageTabContent value="python">
```bash filename="Install dependencies" copy
cd my-project
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```
  </LanguageTabContent>
</LanguageTabs>

You should see: `Successfully generated X models from ClickHouse tables`

### Explore Your Generated Models
<LanguageTabs>
  <LanguageTabContent value="python">
Check what Moose created from your tables in the `app/main.py` file:
<FileTree>
<FileTree.Folder name="app" defaultOpen>
<FileTree.File name="main.py" />
</FileTree.Folder>
</FileTree>

<Callout type="info" title="Import Pattern">
<div>Your generated table models are imported here so Moose can detect them.</div>
<div className="text-sm mt-2">Learn more about export pattern: <a href="/moosestack/local-dev-environment?lang=python#hot-reloading-development" className="text-blue-500 hover:underline">local development</a> / <a href="/moosestack/migrate?lang=python" className="text-blue-500 hover:underline">hosted</a></div>
</Callout>
  </LanguageTabContent>
  <LanguageTabContent value="typescript">
Check what Moose created from your tables in the `app/index.ts` file:
<FileTree>
<FileTree.Folder name="app" defaultOpen>
<FileTree.File name="index.ts" />
</FileTree.Folder>
</FileTree>

<Callout type="info" title="Export Pattern">
<div>Your generated table models are exported here so Moose can detect them.</div>
<div className="text-sm mt-2">Learn more about export pattern: <a href="/moosestack/local-dev-environment?lang=typescript#hot-reloading-development" className="text-blue-500 hover:underline">local development</a> / <a href="/moosestack/migrate?lang=typescript" className="text-blue-500 hover:underline">hosted</a></div>
</Callout>
  </LanguageTabContent>
</LanguageTabs>

### If your database includes ClickPipes/PeerDB (CDC) tables

As noted above, when you use `moose init --from-remote`, Moose introspects your database. If it detects CDC‚Äëmanaged tables (e.g., PeerDB/ClickPipes with fields like `_peerdb_synced_at`, `_peerdb_is_deleted`, `_peerdb_version`), it marks those as `EXTERNALLY_MANAGED` and writes them into a dedicated external models file. Your root file is updated to load these models automatically.

<LanguageTabs>
  <LanguageTabContent value="typescript">
<FileTree>
  <FileTree.Folder name="app" defaultOpen>
    <FileTree.File name="index.ts" />
    <FileTree.File name="externalModels.ts" />
  </FileTree.Folder>
</FileTree>
  </LanguageTabContent>
  <LanguageTabContent value="python">
<FileTree>
  <FileTree.Folder name="app" defaultOpen>
    <FileTree.File name="main.py" />
    <FileTree.File name="external_models.py" />
  </FileTree.Folder>
</FileTree>
  </LanguageTabContent>
</LanguageTabs>

This separation is a best‚Äëeffort by the CLI to keep clearly CDC‚Äëowned tables external. For other tables you don't want Moose to manage, set the lifecycle to external and move them into the external file. See: 
- [External Tables](/moosestack/olap/external-tables) documentation for more information on how external tables work.
- [DB Pull](/moosestack/olap/db-pull) for keeping models in sync with the remote schema.

<br />

## Step 3: Start Development

Start your development server. This spins up a local ClickHouse instance that perfectly mirrors your production schema:

```bash filename="Start your dev server" copy
moose dev
```

**What happens when you run `moose dev`:**
- üèóÔ∏è Creates a local ClickHouse instance with your exact table schemas in your project code
- üîÑ Hot-reloads migrations to your local infrastructure as you save code changes
- üöÄ Starts a web server for building APIs

<Callout type="info" title="Production Safety" compact={true}>
Your production ClickHouse remains completely untouched. This is a separate, local development environment.
</Callout>

<ToggleBlock openText="Show expected output" closeText="Hide output">
```txt
       Created docker compose file
‚°ó Starting local infrastructure
  Successfully started containers
     Validated clickhousedb-1 docker container
     Validated redpanda-1 docker container
  Successfully validated red panda cluster
     Validated temporal docker container
  Successfully ran local infrastructure
      Node Id: my-analytics-app::b15efaca-0c23-42b2-9b0c-642105f9c437
      Starting development mode
      Watching "/path/to/my-analytics-app/app"
       Started Webserver.


  Next Steps   

üíª Run the moose üëâ `ls` üëà command for a bird's eye view of your application and infrastructure

üì• Send Data to Moose
	Your local development server is running at: http://localhost:4000/ingest
```

Don't see this output? [Check out the troubleshooting section](#troubleshooting)
</ToggleBlock>

### Seed Your Local Database (Optional)
Copy real data from your production ClickHouse to your local development environment. This gives you realistic data to work with during development.

**Why seed?** Your local database starts empty. Seeding copies real data so you can:
- Test with realistic data volumes
- Debug with actual production data patterns
- Develop features that work with real data structures

<Tabs defaultValue="own-seed">
<TabsList>
<TabsTrigger value="own-seed">From your own ClickHouse</TabsTrigger>
<TabsTrigger value="playground-seed">From the ClickHouse Playground</TabsTrigger>
<TabsTrigger value="env-var">Using env var</TabsTrigger>
</TabsList>
<TabsContent value="own-seed">
```bash filename="Terminal" copy
moose seed clickhouse --connection-string <YOUR_CLICKHOUSE_CONNECTION_STRING> --limit 100000
```

**Connection String Format:**
The connection string must use ClickHouse native protocol:
```bash
# ClickHouse native protocol (secure connection)
clickhouse://username:password@host:9440/database
```

**Note:** Data transfer uses ClickHouse's native TCP protocol via `remoteSecure()`. The remote server must have the native TCP port accessible. The command automatically handles table mismatches gracefully.
</TabsContent>
<TabsContent value="playground-seed">
```bash filename="Terminal" copy
moose seed clickhouse --connection-string clickhouse://explorer:@play.clickhouse.com:9440/default --limit 100000
```
</TabsContent>
<TabsContent value="env-var">
```bash filename="Terminal" copy
# You can omit --connection-string by setting an env var
export MOOSE_SEED_CLICKHOUSE_URL='clickhouse://username:password@host:9440/database'

# copy a limited number of rows (batched under the hood)
moose seed clickhouse --limit 100000
```
</TabsContent>
</Tabs>

<Callout type="info" title="Notes">
- `--limit` and `--all` are mutually exclusive
- `--all` can be used to copy the entire table(s), use with caution as it can be very slow and computationally intensive.
- Large copies are automatically batched to avoid remote limits; you'll see per-batch progress.
- If you stop with Ctrl+C, the current batch finishes and the command exits gracefully.

**Expected Output:**
```bash
‚úì Database seeding completed
Seeded 'local_db' from 'remote_db'

‚úì table1: copied from remote
‚ö†Ô∏è  table2: skipped (not found on remote)
‚úì table3: copied from remote
```

**Troubleshooting:**
- Tables that don't exist on remote are automatically skipped with warnings
- Use `--table <name>` to seed a specific table that exists in both databases
- Check `moose ls table` to see your local tables
</Callout>

<br />

## Step 4: Build Your First API
Now that you have your data models, let's build something useful! You can create APIs, materialized views, and applications with full type safety.

<Callout type="info" title="What you can build">
- **REST APIs** that expose your ClickHouse data to frontend applications
- **Materialized Views** for faster queries and aggregations
- **Streaming pipelines** for real-time data processing
- **Full-stack applications** with your ClickHouse data as the backend
</Callout>

### Add APIs

Build REST APIs on top of your existing tables to expose your data to your user-facing apps. This is a great way to get started with Moose without changing any of your existing pipelines.

<LanguageTabs>
  <LanguageTabContent value="typescript">
```ts copy
import { TargetSchema, materializedView } from "./myMaterializedView";


export interface QueryParams {
  date: Date;
  limit?: number;
}

const api = new Api<QueryParams, TargetSchema>("get-aggregated-data",
  async ({ date, limit = 10 }: QueryParams, { client, sql }) => {
    const query = sql`
        SELECT * FROM ${materializedView.targetTable} 
        WHERE date = ${date} 
        LIMIT ${limit}`;

    const result = await client.query.execute<TargetSchema>(query); // Type-safe query execution
    return result.json();
  }
);
```
  </LanguageTabContent>
</LanguageTabs>

<Callout type="info" title="Building APIs with Moose" href="/moosestack/apis" ctaLabel="Learn more">
Check out the MooseAPI module for more information on building APIs with Moose.
</Callout>

### Build Materialized Views 
Build materialized views on top of your existing tables to improve query performance. If you have Materialized Views in your ClickHouse, you can use Moose to build new Materialized Views on top of your existing tables, or to migrate your existing Materialized Views to Moose.

<LanguageTabs>
  <LanguageTabContent value="typescript">
```ts copy
// Data Model for your Materialized View- use type throughout your codebase
export interface TargetSchema {
  date: Date;
  count: number;
}
// Creates both the target table and the materialized view
export const materializedView = new MaterializedView<TargetSchema>({
  // Raw SQL with type-safe table references
  selectStatement: sql`SELECT count(*) as count, date FROM ${myTable} GROUP BY date`,
  selectTables: [myTable], // Automatic dependency resolution for cascading materialized views
  engine: ClickHouseEngines.MergeTree, // Can use which ever engine you want
  orderByFields: ["date"],
  tableName: "myAggregation",
  materializedViewName: "myAggregation_MV",
});
```
  </LanguageTabContent>
</LanguageTabs>


<Callout type="info" title="Building Materialized Views with Moose" href="/moosestack/olap/model-materialized-view" ctaLabel="Learn more">
Check out the MooseOLAP module for more information on building Materialized Views with Moose.
</Callout>


<br />

## Known Limitations

<Callout type="warning" title="Early Access Feature" ctaLabel="Join Slack" href="https://join.slack.com/t/moose-community/shared_invite/zt-2fjh5n3wz-cnOmM9Xe9DYAgQrNu8xKxg">
Some advanced ClickHouse features may not be fully supported yet. Join the Moose Slack and let us know if you have any issues, feedback, or requests.
</Callout>

**What we're working on:**
- **Selective table import** (currently imports all tables)
- **Default value annotations** 

<br />

## Troubleshooting
### Error: Failed to connect to ClickHouse

This guide shows exactly where to find your host, port, username, and password, and how to construct a valid HTTPS connection string.

<Tabs defaultValue="cloud">
<TabsList>
<TabsTrigger value="cloud">ClickHouse Cloud</TabsTrigger>
<TabsTrigger value="self-hosted">Self-Hosted or Docker</TabsTrigger>
</TabsList>
<TabsContent value="cloud">
1. Log into your [ClickHouse Cloud console](https://clickhouse.cloud/)
2. Open your service details page
3. Click "Connect" in the sidebar
<div className="flex justify-center p-10">
<ZoomImg light="/ch-cloud-sidebar.png" dark="/ch-cloud-sidebar.png" alt="ClickHouse Cloud Connect Button" />
</div>
4. Select the `HTTPS` tab and copy the values shown
   - **Host**: e.g. `your-service-id.region.clickhouse.cloud`
   - **Port**: usually `8443`
   - **Username**: usually `default`
   - **Password**: the password you configured
<div className="flex justify-center p-10">
<ZoomImg light="/ch-cloud-creds.png" dark="/ch-cloud-creds.png" alt="ClickHouse Cloud HTTPS Connection Details" />
</div>
5. Build your connection string:

```txt
https://USERNAME:PASSWORD@HOST:PORT/?database=DATABASE_NAME
```

6. Example (with placeholders):

```txt
https://default:your_password@your-service-id.region.clickhouse.cloud:8443/?database=default
```

7. Optional: Test with curl

```bash
curl --user "USERNAME:PASSWORD" --data-binary "SELECT 1" https://HOST:PORT
```
</TabsContent>
<TabsContent value="self-hosted">
### Self-hosted or Docker
- Check your server config (usually `/etc/clickhouse-server/config.xml`)
  - `<http_port>` default: `8123`
  - `<https_port>` default: `8443`
- Check users in `/etc/clickhouse-server/users.xml` or `users.d/`
- For Docker, check environment variables in your compose/run config:
  - `CLICKHOUSE_USER`, `CLICKHOUSE_PASSWORD`, `CLICKHOUSE_DB`

Build the HTTPS connection string with your values:

```txt
https://USERNAME:PASSWORD@HOST:8443/?database=DB
```

If you only have HTTP enabled, enable HTTPS or use an HTTPS proxy; Moose init expects an HTTPS URL for remote introspection.
</TabsContent>
</Tabs>

### `moose dev` fails to start

Double check Docker is running and you do not have any port conflicts.

- ClickHouse local runs on port `18123`
- Your local webserver runs on port `4000`
- Your local management API runs on port `5001`

## What's Next?

Ready to build more? Check out the [APIs](/moosestack/apis) and [OLAP](/moosestack/olap) documentation to learn how to build powerful features on top of your ClickHouse data.
