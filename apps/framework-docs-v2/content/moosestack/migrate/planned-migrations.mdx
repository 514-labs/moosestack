---
title: Planned Migrations
description: Generate and review deterministic migration plans
order: 6
category: olap
---

# Planned Migrations

Planned migrations split schema change work into two clear steps:

1. Generate a reviewed plan file.
2. Apply that exact plan in deployment.

## Generate a plan

```bash
moose generate migration \
  --olap-engine clickhouse \
  --olap-url "$MOOSE_OLAP__CONNECTION" \
  --save
```

Generated files:

- `migrations/plan.yaml`
- `migrations/remote_state.json`
- `migrations/local_infra_map.json`

## Review rules

- Review every operation in `plan.yaml`.
- Reject destructive changes unless explicitly intended.
- Commit the whole `migrations/` directory.

## Apply plan

```bash
moose migrate --olap-engine clickhouse --olap-url "$MOOSE_OLAP__CONNECTION"
```

## Drift behavior

If remote state changed after plan generation, Moose stops with `migration_contract_error`.

## Related pages

- [moose migrate](/moosestack/migrate/apply-planned-migrations-cli)
- [Migration Plan Format](/moosestack/migrate/plan-format)
