---
title: Migrations
description: Understanding how Moose manages database schema changes through code
order: 0
category: migrate
---

import { Callout } from "@/components/mdx";

# Migrations

When you define database tables in your code, you need a way to synchronize those definitions with your production infrastructure. As your application evolves, you'll add/remove fields, change data types, and restructure tables. Migrations are the mechanism that makes these schema changes safely and reliably.

## What Are Migrations?

Migrations are operations that update your database schema to match your code definitions. Instead of manually writing SQL commands or managing schema changes through a database interface, you declare your desired schema in code, and Moose Migrate calculates what needs to change and applies those changes for you.

<Callout type="info" title="Version Control for your Database">
Just as Git tracks changes to your code, migrations track changes to your schema, creating an audit trail and enabling safe, repeatable deployments.
</Callout>

### Why Migrations Matter

Database schema changes are risky. A mistaken column drop can lose customer data. An incorrectly applied change during high traffic can cause downtime. Manual SQL scripts are error-prone and hard to track across environments.

Moose Migrate solves these problems by:

- **Generating changes automatically** - You focus on your schema definition, not SQL syntax
- **Providing review workflows** - See exactly what will change before it happens
- **Detecting conflicts** - Know when someone else has modified the database
- **Preserving data** - Use rename operations instead of destructive drop-and-recreate
- **Creating audit trails** - Track every schema change through version control

## How Migrations Work

Moose Migrate operates through a comparison model. The system compares two states:

1. **Your code** - Tables and streams defined in your application
2. **Your database** - The actual schema in ClickHouse, Kafka, or Redpanda

When these states differ, Moose generates a set of operations to bring them into alignment. These operations might include:

- Adding or dropping tables
- Adding, removing, or renaming columns
- Changing data types
- Creating or modifying streaming topics

The key insight is that Moose handles the complexity of schema evolution so you can focus on your application logic.

## Core Concepts

Migrations in Moose revolve around a few key decisions. Think of this section as your map—here’s where to find the details on how to configure, run, and manage your schema changes.

| Concept | What it is | Where to go |
| :--- | :--- | :--- |
| **Migration Types** | Deciding *how* changes are generated. | [Auto-Inferred](./auto-inferred) • [Planned](./planned-migrations) |
| **Lifecycle Management** | Controlling *what* changes are allowed (e.g., preventing data deletion). | [Fully Managed](./lifecycle-fully-managed) • [Deletion Protected](./lifecycle-deletion-protected) • [Externally Managed](./lifecycle-externally-managed) |
| **Applying Changes** | The workflow for executing migrations: serverless (`moose migrate`) vs server runtime (`moose prod`). | [Serverless](./apply-planned-migrations-cli) • [Server Runtime](./apply-planned-migrations-service) |
| **Failed Migrations** | Understanding how to recover from failed migrations. | [Failed Migrations](./failed-migrations) |
| **Plan Format** | Deep dive into the format of the migration plan file. | [Plan Format](./plan-format) |

### Quick Guide: Which path should I take?

- **Just starting out?** Stick to **auto-inferred** migrations in development. It’s fast and keeps you in the flow.
- **Going to production?** Switch to **planned** migrations. You’ll get a reviewable plan (like a PR for your database) and safety checks.
- **Integrating into an existing app?** Use **serverless** (`moose migrate`) to control exactly when migrations run.
- **Building a dedicated data platform?** Use the **Server Runtime** (`moose prod`) to handle the lifecycle automatically.

For a complete breakdown of commands and flags, head over to the [Reference](./reference) page.

