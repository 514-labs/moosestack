---
title: Configuration
description: Understand how MooseStack configuration works
order: 10
---

import { Callout } from "@/components/mdx";

# Configuration

Moose uses a layered configuration system that combines a structured configuration file with environment variables. This allows you to define safe project defaults in code while injecting secrets and environment-specific settings at runtime.

## Concept

The Moose configuration system is designed around two distinct needs:

1.  **Project Definition (`moose.config.toml`)**: Defines the structure of your project, language settings, and local development infrastructure. This file is committed to git and provides the "blueprint" for your application.
2.  **Runtime Configuration (Environment Variables)**: Overrides the project definition with environment-specific values (e.g., production database URLs, passwords, API keys). These are never committed to git.

When Moose starts, it merges these sources to create the final configuration.

## Configuration Resolution

Moose resolves configuration values in the following order of precedence (highest to lowest):

1.  **System Environment Variables** (`MOOSE_*`)
    *   *Highest priority.* Values set in the shell or deployment platform override everything else.
2.  **`.env.local`**
    *   *Local overrides.* Gitignored file for local development secrets.
3.  **`.env.{environment}`**
    *   *Environment profiles.* Files like `.env.prod` or `.env.dev`.
4.  **`.env`**
    *   *Global defaults.* Shared defaults committed to git.
5.  **`moose.config.toml`**
    *   *Project structure.* The base configuration file.
6.  **Moose Defaults**
    *   *Fallback.* Built-in defaults provided by the framework.

<Callout type="info" title="Implementation Details">
See the configuration loading implementation in the source code:
- [`dotenv.rs`](https://github.com/514-labs/moose/blob/main/apps/framework-cli/src/utilities/dotenv.rs) - See `load_dotenv_files` function
- [`project.rs`](https://github.com/514-labs/moose/blob/main/apps/framework-cli/src/project.rs) - See `load` function in the `Project` impl block
</Callout>

## Using Environment Variables

Environment variables are the primary mechanism for managing secrets and differentiating between environments (Dev vs. Prod).

### Variable Syntax

All Moose environment variables follow a standardized naming convention that maps directly to the structure of `moose.config.toml`.

*   **Prefix**: `MOOSE_`
*   **Separator**: `__` (double underscore) for nested sections.
*   **Case**: UPPER_CASE.

**Example Mapping:**

| Config in `moose.config.toml` | Environment Variable |
|:----------------------------|:---------------------|
| `clickhouse_config.host` | `MOOSE_CLICKHOUSE_CONFIG__HOST` |
| `clickhouse_config.port` | `MOOSE_CLICKHOUSE_CONFIG__PORT` |
| `features.workflows` | `MOOSE_FEATURES__WORKFLOWS` |
| `redis_config.url` | `MOOSE_REDIS_CONFIG__URL` |

### .env File Strategy

We recommend the following strategy for managing `.env` files:

| File | Purpose | Committed? | Loaded In |
|:-----|:--------|:-----------|:----------|
| `.env` | Safe, shared defaults (e.g., port numbers) | ✅ Yes | All Environments |
| `.env.dev` | Development-specific flags (e.g., debug logging) | ✅ Yes | `moose dev` |
| `.env.prod` | Production-specific flags (e.g., json logging) | ✅ Yes | `moose prod`, `moose build` |
| `.env.local` | **SECRETS** (passwords, API keys) and local overrides | ❌ **NO** | `moose dev` only |

<Callout type="warning" title="Production Security">
In production, do not rely on `.env` files for secrets if your platform supports native secret management (e.g., Kubernetes Secrets, AWS Secrets Manager). Inject secrets as system environment variables (`MOOSE_CLICKHOUSE_CONFIG__PASSWORD=...`) directly into the container.
</Callout>

## Configuration Reference

Detailed configuration options for each part of the stack.

*   **[Project Configuration](/moosestack/configuration/project)**
    *   Top-level settings, language selection, and telemetry.
*   **[Infrastructure](/moosestack/configuration/infrastructure)**
    *   Connection settings for ClickHouse, Redpanda, Redis, Temporal, and the HTTP Server.
*   **[Authentication](/moosestack/configuration/authentication)**
    *   JWT validation and API security settings.
*   **[Features & Migrations](/moosestack/configuration/features-migrations)**
    *   Feature flags and database migration behavior.
*   **[Dev Environment](/moosestack/configuration/dev-environment)**
    *   Local development scripts, custom docker services, and networking.
