---
title: Infrastructure Configuration
description: Configure ClickHouse, Redpanda, Redis, Temporal, and the HTTP Server
order: 40
---

import { Callout } from "@/components/mdx";

# Infrastructure Configuration

This reference covers the configuration for the core infrastructure components that Moose Runtime manages (in development) or connects to (in production).

<Callout type="warning" title="Critical Security Warning">
**NEVER put production secrets (passwords, API keys) in `moose.config.toml`**.

The infrastructure configuration in `moose.config.toml` is primarily used by `moose dev` to spin up local Docker containers. For production environments or when connecting to external infrastructure, **ALWAYS use environment variables** or `.env.prod` files to securely inject credentials.
</Callout>

## ClickHouse Configuration

Configure the OLAP database connection and behavior.

```toml
[clickhouse_config]
# Database name (Default: "local")
db_name = "local"
# ClickHouse user (Default: "panda")
user = "panda"
# ClickHouse password (Default: "pandapass")
password = "pandapass"
# Whether to use SSL for connection (Default: false)
use_ssl = false
# ClickHouse host (Default: "localhost")
host = "localhost"
# ClickHouse HTTP port (Default: 18123)
host_port = 18123
# ClickHouse native protocol port (Default: 9000)
native_port = 9000
```

| Key | Env Variable | Default | Description |
|:----|:-------------|:--------|:------------|
| `db_name` | `MOOSE_CLICKHOUSE_CONFIG__DB_NAME` | "local" | The database name to use. |
| `user` | `MOOSE_CLICKHOUSE_CONFIG__USER` | "panda" | Database user. |
| `password` | `MOOSE_CLICKHOUSE_CONFIG__PASSWORD` | "pandapass" | **SECRET**. Use env var in prod. |
| `use_ssl` | `MOOSE_CLICKHOUSE_CONFIG__USE_SSL` | false | Enable SSL connection. |
| `host` | `MOOSE_CLICKHOUSE_CONFIG__HOST` | "localhost" | ClickHouse server host. |
| `host_port` | `MOOSE_CLICKHOUSE_CONFIG__HOST_PORT` | 18123 | HTTP interface port (and Docker bind port in dev). |
| `native_port` | `MOOSE_CLICKHOUSE_CONFIG__NATIVE_PORT` | 9000 | Native TCP protocol port. |

## Redpanda (Kafka) Configuration

Configure the streaming platform.

```toml
[redpanda_config]
# Broker connection string (e.g., "host:port") (Default: "localhost:19092")
broker = "localhost:19092"
# Message timeout in milliseconds (Default: 1000)
message_timeout_ms = 1000
# SASL username for authentication (Default: None)
# sasl_username = "user"
# SASL password for authentication (Default: None)
# sasl_password = "password"
# SASL mechanism (e.g., "PLAIN", "SCRAM-SHA-256") (Default: None)
# sasl_mechanism = "PLAIN"
# Security protocol (e.g., "SASL_SSL", "PLAINTEXT") (Default: None)
# security_protocol = "SASL_SSL"
```

| Key | Env Variable | Default | Description |
|:----|:-------------|:--------|:------------|
| `broker` | `MOOSE_REDPANDA_CONFIG__BROKER` | "localhost:19092" | Kafka broker address (and Docker bind address in dev). |
| `sasl_username` | `MOOSE_REDPANDA_CONFIG__SASL_USERNAME` | - | SASL username. |
| `sasl_password` | `MOOSE_REDPANDA_CONFIG__SASL_PASSWORD` | - | **SECRET**. SASL password. |
| `sasl_mechanism` | `MOOSE_REDPANDA_CONFIG__SASL_MECHANISM` | - | e.g., "PLAIN", "SCRAM-SHA-256". |
| `security_protocol`| `MOOSE_REDPANDA_CONFIG__SECURITY_PROTOCOL`| - | e.g., "SASL_SSL". |

## Redis Configuration

Configure the caching and state management layer.

<Callout type="info" title="Configuration Precedence">
If `url` is provided, it takes precedence over `hostname`, `port`, `password`, etc.
</Callout>

```toml
[redis_config]
# Redis connection URL (Default: "redis://127.0.0.1:6379")
url = "redis://127.0.0.1:6379"
# Namespace prefix for all Redis keys (Default: "MS")
key_prefix = "MS"
```

| Key | Env Variable | Default | Description |
|:----|:-------------|:--------|:------------|
| `url` | `MOOSE_REDIS_CONFIG__URL` | "redis://127.0.0.1:6379" | Full connection URL. |
| `key_prefix` | `MOOSE_REDIS_CONFIG__KEY_PREFIX` | "MS" | Prefix for keys used by Moose. |

## Temporal Configuration

Configure the workflow orchestration engine.

```toml
[temporal_config]
# Temporal server host (Default: "localhost")
temporal_host = "localhost"
# Temporal server port (Default: 7233)
temporal_port = 7233
# API key for Temporal Cloud connection (Default: "")
api_key = ""
# Temporal namespace (Default: "default")
namespace = "default"
```

| Key | Env Variable | Default | Description |
|:----|:-------------|:--------|:------------|
| `temporal_host` | `MOOSE_TEMPORAL_CONFIG__TEMPORAL_HOST` | "localhost" | Temporal server host. |
| `temporal_port` | `MOOSE_TEMPORAL_CONFIG__TEMPORAL_PORT` | 7233 | Temporal server port. |
| `api_key` | `MOOSE_TEMPORAL_CONFIG__API_KEY` | "" | **SECRET**. API Key for Temporal Cloud. |
| `namespace` | `MOOSE_TEMPORAL_CONFIG__NAMESPACE` | "default" | Temporal namespace. |

## HTTP Server Configuration

Configure the local development server.

```toml
[http_server_config]
# Host to bind the webserver to (Default: "localhost")
host = "localhost"
# Port for the main API server (Default: 4000)
port = 4000
# Port for the management server (Default: 5001)
management_port = 5001
```

| Key | Env Variable | Default | Description |
|:----|:-------------|:--------|:------------|
| `host` | `MOOSE_HTTP_SERVER_CONFIG__HOST` | "localhost" | Server bind address. |
| `port` | `MOOSE_HTTP_SERVER_CONFIG__PORT` | 4000 | Main API port. |
| `management_port`| `MOOSE_HTTP_SERVER_CONFIG__MANAGEMENT_PORT` | 5001 | Internal management port. |

## State Storage

Configure where migration state is stored.

```toml
[state_config]
# Storage backend: "clickhouse" (default) or "redis"
storage = "clickhouse"
```

| Key | Env Variable | Default | Description |
|:----|:-------------|:--------|:------------|
| `storage` | `MOOSE_STATE_CONFIG__STORAGE` | "clickhouse" | Backend for state storage. |
