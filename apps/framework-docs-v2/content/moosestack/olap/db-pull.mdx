---
title: Introspecting Tables
description: Introspect a live ClickHouse database to generate and update your external table models
order: 16
category: olap
---

import { Callout, LanguageTabs, LanguageTabContent, BulletPointsCard } from "@/components/mdx";

# Introspecting Tables

## Overview

**Introspection** allows your application code to adapt to a database schema that is managed externally.

When you run `moose db pull`, Moose CLI connects to a live ClickHouse instance, reads the schema of tables marked as `EXTERNALLY_MANAGED`, and automatically generates the corresponding TypeScript or Python models.

This enables a **database-first** workflow for parts of your data stack where the schema is dictated by upstream systems (like CDC pipelines, ETL jobs, or DBAs) rather than your application code.

## When to use it

- **Continuous Introspection**: Keep your local type definitions in sync with a rapidly evolving production database.
- **CDC Integration**: Automatically discover and model new tables created by ingestion tools like ClickPipes or PeerDB.
- **Safe Updates**: Refresh your external models without risking changes to your application-managed tables.

<Callout type="info">
  This command is **read-only** for your database. It updates your *code* to match the *database*, never the other way around.
</Callout>

## How it works

`moose db pull` treats the remote database as the single source of truth for external tables.

1.  **Connects** to the target ClickHouse instance.
2.  **Updates** existing tables in your code that are marked as `EXTERNALLY_MANAGED`.
3.  **Generates** new models for any tables found in the database that are not yet defined in your code.
4.  **Consolidates** these definitions into a single file (`app/externalModels.ts` or `app/external_models.py`).

### The Generated File


Moose consolidates all introspected models into one file to keep them isolated from your manually written code.

<LanguageTabs>
  <LanguageTabContent value="typescript">
`app/externalModels.ts` (Default)
  </LanguageTabContent>
  <LanguageTabContent value="python">
`app/external_models.py` (Default)
  </LanguageTabContent>
</LanguageTabs>

You can customize this location using the `--file-path` flag.

<Callout type="warning" title="Do not edit this file manually">
  If the file exists when you run `db pull`, it is overwritten. Any manual changes will be lost.
</Callout>

## Managing Table Lifecycle

### Moving a table to Moose Management

If you want to take ownership of a table that was previously external (e.g., you want to manage its schema via migrations):

1.  **Copy** the table definition from the generated external models file.
2.  **Paste** it into a new file in your `app/` directory (e.g., `app/MyTable.ts`).
3.  **Remove** the `lifeCycle: LifeCycle.EXTERNALLY_MANAGED` property from the definition.


When `moose db pull` again, Moose OLAP will see the table is now managed by you and it will not be included in the generated file.

Now, Moose OLAP will track schema changes for this table and generate migrations for it.

## Usage

### Command

```bash filename="Terminal"
moose db pull --connection-string <CLICKHOUSE_URL> [--file-path <PATH>]
```

- **`--connection-string`**: The URL of the remote ClickHouse instance.
- **`--file-path`**: (Optional) Path to the file where external models will be written. Defaults to `app/externalModels.ts` (TS) or `app/external_models.py` (Python).

### Connection Strings

You can use native or HTTP(S) connection strings.

```bash filename="Terminal"
# Native (auto-converted to HTTPS)
moose db pull --connection-string "clickhouse://user:pass@host:9440/db"

# HTTPS
moose db pull --connection-string "https://host:8443/?user=user&password=pass&database=db"
```

## Workflows

### 1. Syncing with Upstream Changes
When an upstream team or process changes a table schema:
1. Run `moose db pull` against the environment where the change occurred.
2. Moose updates your `externalModels` file.
3. Your IDE immediately highlights any type errors in your code caused by the schema change (e.g., a renamed column).

### 2. Auto-Discovery of New Tables
If your CDC tool (e.g., ClickPipes) creates new tables dynamically:
1. Run `moose db pull`.
2. Moose detects the new tables in ClickHouse.
3. New models are added to your `externalModels` file, ready for you to query.

### 3. Automated Dev Environment
Ensure your local environment always matches production by adding a hook to `moose.config.toml`. This runs introspection every time you start your dev server.

```toml filename="moose.config.toml"
[http_server_config]
on_first_start_script = "moose db pull --connection-string <CONNECTION_STRING> --file-path <OUTPUT_PATH>"
```

<Callout type="warning" title="Do not put production connection strings in your config file">
This config is committed to your repository. Best practice is use environment variables to store your connection strings.

```bash filename="Terminal"
CLICKHOUSE_CONNECTION_STRING="https://username:password@host:8443/?database=default" moose dev
```

```toml filename="moose.config.toml"
[http_server_config]
on_first_start_script = "moose db pull --connection-string $CLICKHOUSE_CONNECTION_STRING --file-path <OUTPUT_PATH>"
```
</Callout>


## Troubleshooting

- **Tables not appearing?** Ensure the remote table exists and that you haven't excluded it via configuration.
- **Type mismatches?** Moose maps ClickHouse types to the closest safe TypeScript/Python type. If a type is unsupported, it will be logged in the output.
- **Connection refused?** Verify your IP is allowlisted on the remote ClickHouse instance.

## Related

- **[External Tables](/moosestack/olap/external-tables)**: Learn how to configure tables as `EXTERNALLY_MANAGED`.
- **[Initialize from ClickHouse](/moosestack/getting-started/from-clickhouse)**: Bootstrap a new project from an existing database.
