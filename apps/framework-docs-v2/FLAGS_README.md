# Feature Flags Setup

## Quick Start

1. **Already configured:**
   - ✅ Vercel Toolbar installed
   - ✅ Flags SDK with PostHog adapter
   - ✅ Discovery endpoint at `/.well-known/vercel/flags`

2. **Required environment variables:**
   ```bash
   FLAGS_SECRET=<auto-generated by toolbar>
   POSTHOG_PERSONAL_API_KEY=<from PostHog settings>
   POSTHOG_PROJECT_ID=<from PostHog settings>
   ```

3. **Usage:**
   - Run `pnpm dev`
   - Open Vercel Toolbar → Flags Explorer
   - Toggle flags to test navigation visibility

## Available Flags

- `show-ai-section` - Controls AI tab visibility (default: off)
- `show-data-sources-page` - Controls Data sources page visibility in navigation (default: off)
- `show-draft-guides` - Show draft guides (internal WIP, not ready for external users) (default: off)
- `show-beta-guides` - Show beta guides (ready for select external users to preview) (default: off)
- `show-copy-as-markdown` - Show Copy Page button in doc & guide pages (default: off)
- `show-linear-integration` - Show Linear integration (scope selector + add to Linear button) on guide pages (default: off)

## Guides Visibility Logic

The Guides tab is always visible in navigation. Individual guide visibility is controlled by the `status` property in `src/config/navigation.ts`:

| Guide Status | Default (both flags OFF) | `show-beta-guides` ON | `show-draft-guides` ON |
|--------------|--------------------------|----------------------|------------------------|
| `status: "draft"` | Hidden | Hidden | Visible |
| `status: "beta"` | Hidden | Visible | Hidden |
| No status (public) | Visible | Visible | Visible |

**Draft and Beta are mutually exclusive sets.** Each flag only reveals its corresponding status level.

**Two-level guide workflow:**
1. **Draft** - Internal WIP, not ready for any external users (enable `show-draft-guides` to see)
2. **Beta** - Ready for select external users (e.g., ClickHouse sales team) to preview (enable `show-beta-guides` to see)
3. **Public** - No status, visible to everyone

**If no guides are visible**, the Guides page shows a "Coming Soon" design.

**Current state:** 
All 5 priority guides are marked as `status: "draft"`. See `GUIDES_README.md` for the full list.

**To promote a guide:**
1. Draft → Beta: Change `status: "draft"` to `status: "beta"` 
2. Beta → Public: Remove the `status` property entirely

## How It Works

- **Flags SDK** automatically reads `vercel-flag-overrides` cookie
- **Resolution order**: Cookie Override → PostHog → Default
- **Dynamic rendering** everywhere for flag overrides to work
- SEO-friendly: Pages still server-render with full HTML

## Files

- `src/flags.ts` - Flag definitions
- `src/app/.well-known/vercel/flags/route.ts` - Discovery endpoint

## Related Documentation

- `GUIDES_README.md` - How to write and promote guides
